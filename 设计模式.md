https://blog.csdn.net/liang19890820/article/details/66974516
# è®¾è®¡æ¨¡å¼ï¼ˆ23ï¼‰
## è®¾è®¡æ¨¡å¼çš„ç±»å‹
- åˆ›å»ºè€…æ¨¡å¼(creational Patterns): ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ä»å®ç°ç³»ç»Ÿåˆ†ç¦»å‡ºæ¥
- ç»“æ„å‹æ¨¡å¼(structural Patterns): ç”¨äºä¸åŒå¯¹è±¡ä¹‹é—´å½¢æˆå¤§å‹å¯¹è±¡ç»“æ„
- è¡Œä¸ºå‹æ¨¡å¼(Behavioral Patterns): ç”¨äºç®¡ç†å¯¹è±¡ä¹‹é—´çš„ç®—æ³•ã€ã€å…³ç³»å’ŒèŒè´£

## å•ä¾‹æ¨¡å¼ï¼š
ä»¥ä¸‹æ˜¯å¯¹C++å•ä¾‹æ¨¡å¼é¢è¯•å¸¸è§é—®é¢˜çš„å®Œæ•´ç­”æ¡ˆæ•´ç†ï¼ŒåŒ…å«æ¦‚å¿µè§£é‡Šã€ä»£ç å®ç°å’Œå…³é”®è¦ç‚¹ï¼š

### ä¸€ã€åŸºç¡€æ¦‚å¿µä¸å®ç°
1. **ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿæ ¸å¿ƒç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ**  
   - **ç­”æ¡ˆ**ï¼šç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚æ ¸å¿ƒç›®çš„æ˜¯ï¼š
     - æ§åˆ¶èµ„æºè®¿é—®ï¼ˆå¦‚é…ç½®ç®¡ç†å™¨ã€çº¿ç¨‹æ± ï¼‰
     - é¿å…é‡å¤åˆ›å»ºå¯¹è±¡çš„å¼€é”€
     - ä¿è¯å…¨å±€çŠ¶æ€çš„ä¸€è‡´æ€§

---

### äºŒã€åŸºç¡€å®ç°
2. **æ‰‹å†™é¥¿æ±‰å¼å•ä¾‹**  
```cpp
class Singleton {
private:
    static Singleton instance;  // é™æ€æˆå‘˜åˆå§‹åŒ–
    Singleton() {}              // ç§æœ‰æ„é€ å‡½æ•°
    
public:
    Singleton(const Singleton&) = delete;             // ç¦ç”¨æ‹·è´
    Singleton& operator=(const Singleton&) = delete;  // ç¦ç”¨èµ‹å€¼
    
    static Singleton& getInstance() {
        return instance;
    }
};
// ç±»å¤–åˆå§‹åŒ–ï¼ˆç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼‰
Singleton Singleton::instance;
```
**ç‰¹ç‚¹**ï¼šçº¿ç¨‹å®‰å…¨ä½†å¯èƒ½æµªè´¹èµ„æº

3. **æ‰‹å†™æ‡’æ±‰å¼å•ä¾‹ï¼ˆC++11çº¿ç¨‹å®‰å…¨ç‰ˆï¼‰**  
```cpp
class Singleton {
private:
    Singleton() {}
    
public:
    Singleton(const Singleton&) = delete;
    Singleton& operator=(const Singleton&) = delete;
    
    static Singleton& getInstance() {
        static Singleton instance;  // C++11ä¿è¯çº¿ç¨‹å®‰å…¨
        return instance;
    }
};
```
**ç‰¹ç‚¹**ï¼šæŒ‰éœ€åˆ›å»ºï¼ŒC++11æ ‡å‡†ä¿è¯é™æ€å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨

---
### æ€»ç»“å¯¹æ¯”è¡¨
| **ç‰¹æ€§**       | **é¥¿æ±‰å¼**                          | **æ‡’æ±‰å¼**                          |
|----------------|------------------------------------|------------------------------------|
| **åˆ›å»ºæ—¶æœº**   | ç¨‹åºå¯åŠ¨æ—¶                         | ç¬¬ä¸€æ¬¡è°ƒç”¨`getInstance()`æ—¶        |
| **çº¿ç¨‹å®‰å…¨**   | å¤©ç„¶å®‰å…¨                           | éœ€é¢å¤–æªæ–½ï¼ˆé”/å±€éƒ¨é™æ€å˜é‡ï¼‰      |
| **èµ„æºå ç”¨**   | å¯èƒ½æµªè´¹ï¼ˆæœªä½¿ç”¨ä¹Ÿåˆ›å»ºï¼‰           | æŒ‰éœ€åˆ›å»ºï¼ŒèŠ‚çº¦èµ„æº                 |
| **å®ç°å¤æ‚åº¦** | ç®€å•                               | ç›¸å¯¹å¤æ‚ï¼ˆéœ€å¤„ç†çº¿ç¨‹å®‰å…¨ï¼‰         |
| **é¦–æ¬¡è®¿é—®æ€§èƒ½** | æ— å»¶è¿Ÿï¼ˆå·²åˆ›å»ºï¼‰                 | æœ‰å»¶è¿Ÿï¼ˆéœ€åˆå§‹åŒ–ï¼‰                 |
| **é€‚ç”¨åœºæ™¯**   | å°å¯¹è±¡ã€ç¡®å®šä¼šä½¿ç”¨ã€å¯åŠ¨ä¸æ•æ„Ÿ     | å¤§å¯¹è±¡ã€å¯èƒ½ä¸ä½¿ç”¨ã€å†…å­˜æ•æ„Ÿ       |
> ğŸ’¡ **ç°ä»£C++æ¨è**ï¼šä¼˜å…ˆä½¿ç”¨**æ‡’æ±‰å¼ï¼ˆå±€éƒ¨é™æ€å˜é‡ï¼‰**ï¼Œå› ä¸ºC++11æ ‡å‡†æ˜ç¡®ä¿è¯å…¶çº¿ç¨‹å®‰å…¨æ€§ï¼Œå®ç°ç®€æ´ä¸”é«˜æ•ˆã€‚
---
å•ä¾‹æ¨¡å¼UMLå›¾ä¾‹ï¼š
![](Pic/singleton.png)
---
## å·¥å‚æ¨¡å¼ï¼š
### C++ å·¥å‚æ¨¡å¼é¢è¯•é«˜é¢‘é—®é¢˜åŠç­”æ¡ˆæ•´ç†

---

#### **1. ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼ï¼Ÿæ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ**
**ç­”**ï¼š  
å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§**åˆ›å»ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘å°è£…åœ¨å·¥å‚ç±»ä¸­ï¼Œå®¢æˆ·ç«¯ä¸ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡å·¥å‚æ¥å£è·å–å¯¹è±¡å®ä¾‹ã€‚  
**æ ¸å¿ƒæ€æƒ³**ï¼š  
- **è§£è€¦**ï¼šåˆ†ç¦»å¯¹è±¡åˆ›å»ºä¸ä½¿ç”¨é€»è¾‘  
- **å°è£…å˜åŒ–**ï¼šå½“åˆ›å»ºé€»è¾‘å˜åŒ–æ—¶ï¼Œåªéœ€ä¿®æ”¹å·¥å‚ç±»  
- **ç»Ÿä¸€å…¥å£**ï¼šé€šè¿‡ç»Ÿä¸€æ¥å£åˆ›å»ºå¤šç§ç›¸å…³å¯¹è±¡  

---

#### **2. å·¥å‚æ¨¡å¼çš„ä¸‰ç§ç±»å‹åŠåŒºåˆ«ï¼Ÿ**
| **ç±»å‹**         | **ç‰¹ç‚¹**                                                                 | **é€‚ç”¨åœºæ™¯**                     |
|------------------|--------------------------------------------------------------------------|----------------------------------|
| **ç®€å•å·¥å‚**     | ä¸€ä¸ªå·¥å‚ç±»åˆ›å»ºæ‰€æœ‰äº§å“ï¼Œé€šè¿‡å‚æ•°åŒºåˆ†ç±»å‹                                 | äº§å“ç±»å‹å°‘ä¸”å›ºå®š                 |
| **å·¥å‚æ–¹æ³•**     | æ¯ä¸ªäº§å“å¯¹åº”ä¸€ä¸ªå·¥å‚å­ç±»ï¼Œéµå¾ªå¼€é—­åŸåˆ™                                   | éœ€è¦æ‰©å±•æ–°äº§å“                   |
| **æŠ½è±¡å·¥å‚**     | åˆ›å»ºå¤šä¸ªäº§å“æ—çš„å¯¹è±¡ï¼ˆä¸€ç»„ç›¸å…³å¯¹è±¡ï¼‰ï¼Œå¼ºè°ƒäº§å“é—´çš„çº¦æŸå…³ç³»               | éœ€è¦ä¿è¯äº§å“å…¼å®¹æ€§ï¼ˆå¦‚UIè·¨å¹³å°ï¼‰ |

---

#### **3. ç®€å•å·¥å‚æ¨¡å¼ç¤ºä¾‹ä»£ç **
```cpp
// äº§å“åŸºç±»
class Product {
public:
    virtual void Operation() = 0;
    virtual ~Product() = default;
};

// å…·ä½“äº§å“A
class ConcreteProductA : public Product {
public:
    void Operation() override { cout << "Product A\n"; }
};

// ç®€å•å·¥å‚
class SimpleFactory {
public:
    static Product* CreateProduct(const string& type) {
        if (type == "A") return new ConcreteProductA();
        if (type == "B") return new ConcreteProductB(); // æ‰©å±•æ–°äº§å“éœ€ä¿®æ”¹æ­¤å¤„
        return nullptr;
    }
};

// å®¢æˆ·ç«¯
Product* p = SimpleFactory::CreateProduct("A");
p->Operation();
```
**ç¼ºç‚¹**ï¼šè¿åå¼€é—­åŸåˆ™ï¼ˆæ–°å¢äº§å“éœ€ä¿®æ”¹å·¥å‚ç±»ï¼‰

---
![](Pic/factory.png)
---
## é€‚é…å™¨æ¨¡å¼ï¼š
---
> â€œé€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œä¸»è¦ç”¨äºè§£å†³æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè®©åŸæœ¬ä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥åä½œã€‚å®ƒçš„æ ¸å¿ƒæ˜¯**å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»ä½œä¸ºä¸­é—´å±‚**ã€‚
>
> **å®ƒåŒ…å«ä¸‰ä¸ªå…³é”®è§’è‰²ï¼š**
> 1.  **ç›®æ ‡æ¥å£ï¼ˆTargetï¼‰ï¼š** è¿™æ˜¯å®¢æˆ·ç«¯æœŸæœ›ä½¿ç”¨çš„æ¥å£ã€‚
> 2.  **è¢«é€‚é…è€…ï¼ˆAdapteeï¼‰ï¼š** è¿™æ˜¯éœ€è¦è¢«å¤ç”¨çš„ã€ä½†æ¥å£ä¸å…¼å®¹çš„ç°æœ‰ç±»ã€‚
> 3.  **é€‚é…å™¨ï¼ˆAdapterï¼‰ï¼š** å®ƒå®ç°ç›®æ ‡æ¥å£ï¼Œå¹¶æŒæœ‰è¢«é€‚é…è€…çš„å¼•ç”¨ã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨ç›®æ ‡æ¥å£çš„æ–¹æ³•æ—¶ï¼Œé€‚é…å™¨å†…éƒ¨ä¼šè°ƒç”¨è¢«é€‚é…è€…çš„ç›¸åº”æ–¹æ³•æ¥å®Œæˆå·¥ä½œã€‚
>
> **ä¸¾ä¸ªä¾‹å­ï¼š** å°±åƒéœ€è¦ä¸€ä¸ª USB-C è½¬ MicroUSB çš„è½¬æ¢å¤´ï¼ˆé€‚é…å™¨ï¼‰ï¼Œæ‰èƒ½è®©æ–°çš„ USB-C æ¥å£ç”µè„‘ï¼ˆå®¢æˆ·ç«¯/ç›®æ ‡ï¼‰ä½¿ç”¨æ—§çš„ MicroUSB æ¥å£è®¾å¤‡ï¼ˆè¢«é€‚é…è€…ï¼‰ã€‚
>
>
> **é€‚é…å™¨æ¨¡å¼çš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š** é›†æˆç¬¬ä¸‰æ–¹åº“ã€å¤ç”¨é—ç•™ä»£ç ã€ç»Ÿä¸€ä¸åŒç»„ä»¶çš„æ¥å£ï¼ˆæ¯”å¦‚å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å™¨ï¼‰ç­‰ã€‚
>
> **å®ƒçš„ä¼˜ç‚¹ä¸»è¦æ˜¯è§£è€¦å®¢æˆ·ç«¯ä¸è¢«é€‚é…è€…ã€å¤ç”¨ç°æœ‰ä»£ç ã€ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ç¼ºç‚¹æ˜¯ä¼šç¨å¾®å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼Œå¦‚æœæ¥å£æœ¬èº«èƒ½ç»Ÿä¸€åˆ™ä¸å¿…ä½¿ç”¨ã€‚â€
![](Pic/adapter.png)

---

## æ¡¥æ¥æ¨¡å¼
åœ¨ C++ é¢è¯•ä¸­å›ç­” **Bridge æ¨¡å¼ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰** æ—¶ï¼Œéœ€è¦æ¸…æ™°è¯´æ˜å…¶æ ¸å¿ƒæ€æƒ³ã€ç»“æ„ã€å®ç°è¦ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ç»“æ„åŒ–å›ç­”å»ºè®®ï¼š

---

### **1. æ ¸å¿ƒå®šä¹‰**
> **Bridge æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†æŠ½è±¡éƒ¨åˆ†ï¼ˆAbstractionï¼‰ä¸å®ç°éƒ¨åˆ†ï¼ˆImplementationï¼‰åˆ†ç¦»ï¼Œä½¿äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚**  
> é€šè¿‡ç»„åˆä»£æ›¿ç»§æ‰¿ï¼Œé¿å…å› å¤šå±‚ç»§æ‰¿å¯¼è‡´çš„ç±»çˆ†ç‚¸é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚

---

### **2. è§£å†³çš„é—®é¢˜**
- **åœºæ™¯**ï¼šå½“ä¸€ä¸ªç±»æœ‰å¤šä¸ªç»´åº¦çš„å˜åŒ–ï¼ˆå¦‚å¹³å°ç±»å‹ Ã— åŠŸèƒ½ç±»å‹ï¼‰ï¼Œä½¿ç”¨ç»§æ‰¿ä¼šå¯¼è‡´ç±»æ•°é‡æŒ‡æ•°çº§å¢é•¿ï¼ˆ`MÃ—N` ä¸ªç±»ï¼‰ã€‚
- **ç—›ç‚¹**ï¼šç´§è€¦åˆçš„ç»§æ‰¿ç»“æ„éš¾ä»¥æ‰©å±•æ–°ç»´åº¦ï¼Œè¿åå¼€é—­åŸåˆ™ã€‚

**ç¤ºä¾‹é—®é¢˜**ï¼š  
å‡è®¾å¼€å‘è·¨å¹³å°å›¾å½¢åº“ï¼Œæ”¯æŒä¸åŒå½¢çŠ¶ï¼ˆåœ†å½¢ã€æ–¹å½¢ï¼‰å’Œæ¸²æŸ“æ–¹å¼ï¼ˆOpenGLã€Vulkanï¼‰ã€‚  
âŒ é”™è¯¯åšæ³•ï¼šä¸ºæ¯ä¸ªç»„åˆåˆ›å»ºå­ç±»ï¼ˆ`OpenGLCircle`, `VulkanCircle`, `OpenGLSquare`...ï¼‰ â†’ ç±»è†¨èƒ€ã€‚

---

### **3. Bridge æ¨¡å¼ç»“æ„**
```plaintext
          +---------------------+        +----------------------+
          |     Abstraction     |<>----->|    Implementor       |
          +---------------------+        +----------------------+
          | + operation()       |        | + operationImpl()    |
          +---------------------+        +----------------------+
                     â–²                              â–²
                     |                              |
          +---------------------+        +----------------------+
          | RefinedAbstraction  |        | ConcreteImplementorA |
          +---------------------+        +----------------------+
          | + operation() {     |        | + operationImpl()    |
          |   impl->operationImpl(); }   +----------------------+
          +---------------------+        | ConcreteImplementorB |
                                         +----------------------+
                                         | + operationImpl()    |
                                         +----------------------+
```

| è§’è‰²                | èŒè´£                                 | C++ å®ç°è¦ç‚¹              |
|---------------------|--------------------------------------|--------------------------|
| **Abstraction**     | å®šä¹‰é«˜å±‚æŠ½è±¡æ¥å£ï¼ŒæŒæœ‰å®ç°å±‚çš„å¼•ç”¨   | æŠ½è±¡ç±»/æ¥å£ï¼ŒåŒ…å« `Implementor*` |
| **RefinedAbstraction** | æ‰©å±•æŠ½è±¡æ¥å£ï¼Œæ·»åŠ ç‰¹å®šåŠŸèƒ½         | ç»§æ‰¿è‡ª `Abstraction`      |
| **Implementor**     | å®šä¹‰å®ç°å±‚æ¥å£                     | æŠ½è±¡ç±»/æ¥å£                |
| **ConcreteImplementor** | å…·ä½“å®ç°ï¼ˆå¦‚ä¸åŒå¹³å°/ç®—æ³•ï¼‰      | å®ç° `Implementor` æ¥å£   |

---

### **4. ä»£ç ç¤ºä¾‹ï¼ˆå›¾å½¢åº“æ¡ˆä¾‹ï¼‰**
```cpp
// å®ç°å±‚æ¥å£ï¼šæ¸²æŸ“å¼•æ“
class Renderer {
public:
    virtual ~Renderer() = default;
    virtual void renderCircle(float x, float y, float radius) = 0;
};

// å…·ä½“å®ç°ï¼šOpenGL
class OpenGLRenderer : public Renderer {
public:
    void renderCircle(float x, float y, float radius) override {
        std::cout << "OpenGL: Circle at (" << x << "," << y << ") r=" << radius << "\n";
    }
};

// å…·ä½“å®ç°ï¼šVulkan
class VulkanRenderer : public Renderer {
public:
    void renderCircle(float x, float y, float radius) override {
        std::cout << "Vulkan: Circle at (" << x << "," << y << ") r=" << radius << "\n";
    }
};

// æŠ½è±¡å±‚ï¼šå›¾å½¢åŸºç±»
class Shape {
protected:
    Renderer* renderer; // æ¡¥æ¥å…³é”®ï¼šæŒæœ‰å®ç°å±‚å¼•ç”¨
public:
    Shape(Renderer* r) : renderer(r) {}
    virtual ~Shape() = default;
    virtual void draw() = 0;
};

// æ‰©å±•æŠ½è±¡ï¼šåœ†å½¢
class Circle : public Shape {
    float x, y, radius;
public:
    Circle(Renderer* r, float x, float y, float r) 
        : Shape(r), x(x), y(y), radius(r) {}
    
    void draw() override {
        renderer->renderCircle(x, y, radius); // å§”æ‰˜ç»™å®ç°å±‚
    }
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    OpenGLRenderer opengl;
    VulkanRenderer vulkan;

    Circle circle1(&opengl, 10, 20, 5);
    circle1.draw(); // è¾“å‡º: OpenGL: Circle at (10,20) r=5

    Circle circle2(&vulkan, 30, 40, 15);
    circle2.draw(); // è¾“å‡º: Vulkan: Circle at (30,40) r=15

    return 0;
}
```

---
---
### 5. UMLç¤ºä¾‹

![](Pic/bridge.svg)

---


## è§‚å¯Ÿè€…æ¨¡å¼
### C++ é¢è¯•ï¼šè§‚å¯Ÿè€…æ¨¡å¼è¯¦è§£

#### **1. æ ¸å¿ƒæ¦‚å¿µ**
è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®šä¹‰äº†å¯¹è±¡é—´**ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»**ã€‚å½“ä¸€ä¸ªå¯¹è±¡ï¼ˆSubjectï¼‰çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡ï¼ˆObserversï¼‰ä¼šè‡ªåŠ¨æ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–°ã€‚

#### **2. å…³é”®è§’è‰²**
| **è§’è‰²**         | **ä½œç”¨**                                                                 |
|------------------|--------------------------------------------------------------------------|
| **Subject**      | ä¸»é¢˜ç±»ï¼Œç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæä¾›æ·»åŠ /åˆ é™¤è§‚å¯Ÿè€…çš„æ¥å£ï¼ŒçŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥è§‚å¯Ÿè€…ã€‚ |
| **Observer**     | è§‚å¯Ÿè€…æ¥å£ï¼Œå®šä¹‰æ›´æ–°æ–¹æ³•ï¼ˆ`update()`ï¼‰ã€‚                                |
| **ConcreteSubject** | å…·ä½“ä¸»é¢˜ç±»ï¼Œå­˜å‚¨çŠ¶æ€ï¼ŒçŠ¶æ€æ”¹å˜æ—¶è§¦å‘é€šçŸ¥ã€‚                             |
| **ConcreteObserver** | å…·ä½“è§‚å¯Ÿè€…ç±»ï¼Œå®ç°æ›´æ–°é€»è¾‘ï¼ˆå“åº”ä¸»é¢˜å˜åŒ–ï¼‰ã€‚                          |

#### **3. C++ å®ç°ç¤ºä¾‹**
```cpp
#include <iostream>
#include <vector>
#include <algorithm>

// è§‚å¯Ÿè€…æ¥å£
class Observer {
public:
    virtual ~Observer() = default;
    virtual void update(float temperature) = 0; // æ›´æ–°æ–¹æ³•
};

// ä¸»é¢˜æ¥å£
class Subject {
public:
    virtual void attach(Observer* o) = 0;    // æ³¨å†Œè§‚å¯Ÿè€…
    virtual void detach(Observer* o) = 0;    // ç§»é™¤è§‚å¯Ÿè€…
    virtual void notify() = 0;               // é€šçŸ¥è§‚å¯Ÿè€…
};

// å…·ä½“ä¸»é¢˜ï¼šæ°”è±¡ç«™
class WeatherStation : public Subject {
private:
    std::vector<Observer*> observers;        // è§‚å¯Ÿè€…åˆ—è¡¨
    float temperature;                       // çŠ¶æ€æ•°æ®
public:
    void setTemperature(float temp) {
        temperature = temp;
        notify(); // çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
    }

    void attach(Observer* o) override {
        observers.push_back(o);
    }

    void detach(Observer* o) override {
        observers.erase(
            std::remove(observers.begin(), observers.end(), o),
            observers.end()
        );
    }

    void notify() override {
        for (Observer* o : observers) {
            o->update(temperature); // è°ƒç”¨è§‚å¯Ÿè€…çš„æ›´æ–°æ–¹æ³•
        }
    }
};

// å…·ä½“è§‚å¯Ÿè€…ï¼šæ‰‹æœºæ˜¾ç¤º
class PhoneDisplay : public Observer {
public:
    void update(float temperature) override {
        std::cout << "[Phone] æ¸©åº¦æ›´æ–°: " << temperature << "Â°C\n";
    }
};

// å…·ä½“è§‚å¯Ÿè€…ï¼šç”µè§†æ˜¾ç¤º
class TVDisplay : public Observer {
public:
    void update(float temperature) override {
        std::cout << "[TV] å½“å‰æ¸©åº¦: " << temperature << "Â°C\n";
    }
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    WeatherStation station;
    PhoneDisplay phone;
    TVDisplay tv;

    station.attach(&phone); // æ³¨å†Œæ‰‹æœºè§‚å¯Ÿè€…
    station.attach(&tv);    // æ³¨å†Œç”µè§†è§‚å¯Ÿè€…

    station.setTemperature(25.5f); // è§¦å‘é€šçŸ¥
    station.setTemperature(30.0f); // å†æ¬¡è§¦å‘é€šçŸ¥

    station.detach(&tv);           // ç§»é™¤ç”µè§†è§‚å¯Ÿè€…
    station.setTemperature(22.0f); // åªæœ‰æ‰‹æœºä¼šæ”¶åˆ°é€šçŸ¥

    return 0;
}
```

#### **4. è¾“å‡ºç»“æœ**
```
[Phone] æ¸©åº¦æ›´æ–°: 25.5Â°C
[TV] å½“å‰æ¸©åº¦: 25.5Â°C
[Phone] æ¸©åº¦æ›´æ–°: 30Â°C
[TV] å½“å‰æ¸©åº¦: 30Â°C
[Phone] æ¸©åº¦æ›´æ–°: 22Â°C
```

---
